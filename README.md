# articlespliter
文章详情按字数自动分页功能

使用simplehtmldom类库，这个类库可以将html文本转换成DOM Node树，所有的文本都在Text Node里，只需要计算Text Node中文字的数量，可以避免把标签文字计算为内容文字数量，于是整个流程简化为如下四步：

1. 遍历整个DOM数，遇到Text Node就计算字数，并判断该Node所在的页数。

2. 如果这个Node在需要显示的页面内，保留这个Node以及他所有的父节点，反之删除节点，

3. 在遍历结束后可以获取文章详情的总页数

4. 将保留下的DOM树元素重新转成html代码并显示

示例：

```php
<?php
require_once('articlespliter.php');
$body = <<<EOD
<p>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb</p>
<br/>
<div>aaaaaaaaaaaaaavvvvvvvvvvvvvvvvvv</div>
EOD;

$articlespliter=new ArticleSpliter();
$articlespliter->count_per_page=10; //每页字数
$articlespliter->show_page=6;  //当前显示第几页
$splitbody=$articlespliter->split($body);
$totalpage=$articlespliter->getTotalPage();
```

## thinkphp 5.0使用
#### 准备工作：
文件保存到 /extend/simpledom下边
增加命名空间   namespace simpledom;
ArticleSpliter文件增加：  require_once(EXTEND_PATH .'simpledom/simple_html_dom_node.php');

#### 使用：
```
use simpledom\ArticleSpliter;
class Index extends Controller
{
    public function index()
    {
        $body = "<p><img src='/17/20201214/201214083909909/20201214083909_fe6f538b7cdad7a8e6fde86d9f4f64f8_1_mwpm_03200403.jpg' /></p> <p><p></p><p>年关将至，房企进入年度业绩“冲刺模式”，各种优惠力度拨动着购房者的心弦，如何使用公积金购房成了绕不开的话题。其实，这些年来，有关住房公积金制度的讨论不绝于耳，核心是存与废的争议。很显然，取消公积金可能群众并非受益者。与其“一刀切”取消，当务之急是加快制度改革的步伐，灵活取用、兼顾公平，让更多群众从这项福利制度中受益。</p><p>公积金从“雪中送炭”变成“锦上添花”</p><p>住房公积金制度设立的初衷，是为了不断满足人们的居住需求，改善我国住房建设资金短缺和供给严重不足的局面。经过多年发展，公积金制度全面推行开，规模不断扩大，对推进住房市场化和住房保障工作发挥了显著作用。</p><p>住房城乡建设部、财政部、中国人民银行联合发布的《全国住房公积金2019年年度报告》显示，2019年全年共发放个人住房公积金贷款286.04万笔、提取人数5648.56万人，住房公积金贷款和提取人数占实缴职工人数约40%。</p><p>正是得益于住房公积金制度的存在，群众可以获得数十万元乃至更多低于商业银行利率的贷款，降低了购房门槛。根据制度设计，个人每月在缴纳公积金的同时，所在单位也会以一定比例缴存公积金至个人账户。日常还贷，公积金还可以直接冲抵，减轻了还款压力，有助于提高生活质量。</p><p>不过，随着这些年各地房价的快速上涨，原本发挥了“雪中送炭”作用的公积金，正变得越来越像是“锦上添花”。</p><p>一方面，现实生活中，仍有企业单位并未给员工缴纳住房公积金，限制了这项福利制度的广泛覆盖。不缴纳公积金的现象在如共享经济等新兴业态以及低收入群体中表现得尤为突出。另一方面，相比于一二线城市动辄几百万元的总房价，不少单位每月几百元的公积金显得杯水车薪。</p><p><img src=\"http://07imgmini.eastday.com/mobile/20201214/20201214083909_fe6f538b7cdad7a8e6fde86d9f4f64f8_1.jpeg\"></p><p>更遭人诟病的是，有的地方提取公积金手续十分繁杂。各种复印件一厚摞不说，公积金管理中心跑了一趟又一趟。“明明是我自己的钱，提取却要看别人脸色”，不少人“吐槽”公积金常年趴在账上，利息少不说，提取的前置条件十分苛刻。还有的楼盘为了快速回笼资金，明目张胆地“拒收”公积金贷款，这更使得一些急于购房的人不得不忍痛割爱放弃公积金贷款。</p><p>审慎对待“取消”呼声</p><p>有一种观点更是尖锐地指出，住房公积金制度是“劫贫济富”，其理由是“穷人”买不起房也就压根用不上，“富人”有钱买房还要使用“池子”里的公积金享受低利率。长此以往，呼吁取消住房公积金制度的声音逐渐占了上风。</p><p>细品呼吁取消的声音会发现，这种声音有相当一部分来自企业界。尤其是一些“企业家”热衷于在各种场合不遗余力呼吁取消公积金，从而为企业减负。更有甚者提出建立“新型制度”作为取消公积金后的补充，却始终未给“新型制度”的设计谋划出清晰的方向，也就成了看得见摸不着的镜花水月。</p><p>在这些“企业家”心中，设法取消住房公积金制度是真，倡导建立新制度恐怕并不一定为真。取消公积金不见得就能使企业“起死回生”，但却是真真切切以牺牲群众福利为代价。一项惠及全民的制度，从出台到推广开，是一个极为审慎、复杂的过程。一旦推倒，再想重建难上加难。</p><p>诚然，我国房地产行业市场化程度已经不低，商业银行成为提供房贷的主体。但这并不意味着，住房公积金制度就变得无足轻重。面对越是高昂的总房价及月供，通过公积金实实在在减轻一定程度的负担就变得越发可贵。</p><p>市场的问题就应当回归市场，企业减负本就应从地价房租、水费电费、减税降费等方面寻求空间，而非一门心思在群众身上“下功夫”。</p><p>改革需力求普惠、公平、保值</p><p>改革住房公积金制度箭在弦上。改革的方向绝不是“一刀切”式盲目取消，而要站在人民群众的立场上，谋划释放制度红利的大文章。</p><p>允许患有重大疾病的职工或其直系亲属提取公积金救急；取消住房公积金个人住房贷款保险、公证、新房评估和强制性机构担保等收费项目；探索建立统一的平台办理住房公积金异地转移接续……可以看到，近年来从上到下加快了改革的节奏。这些改革力求呼应新时代群众对住房公积金制度改革的期待，仍有进一步提升的空间。</p><p>公积金的提取方式需更为灵活，租房、装修、旧房翻新等与住房密切相关的用途，使用公积金应进一步减少手续，做到应办尽办。对于重大疾病、家庭变故等应急需求，甚至是医疗、养老，也可考虑特殊性，适当放宽使用范围，力争让沉淀的公积金物尽其用。</p><p>鼓励各地创新形式扩大缴存，将公积金盘子做大，夯实支持住房保障的基础。公积金本就是一种补贴政策，而相当一部分需要提升购买力的低收入群体并未被纳入。扩大住房公积金覆盖面，既是提高缴存“蛋糕”，缓解资金压力的方式之一，更是让这项福利惠及更多群众，减轻购房压力的具体体现。对低收入群体可实行反向补贴政策，即高工资人群多缴政府少缴，低工资人群少缴政府多缴，体现公平。</p><p>在解决一些地方资金池“见底”、存量资金贬值等群众关心的焦点问题上，可探索住房公积金制度跨区域统筹，以及资产证券化等手段，及时总结经验，借鉴推广。</p><p>只要思想不滑坡，方法总比困难多。任何制度设计，只有真正以人民群众作为出发点，回归初心了，才能得到更广泛的支持，具备更持久的生命力。</p><p>（毛振华）</p></p>";
        $articlespliter=new ArticleSpliter();
        $articlespliter->count_per_page=300; //每页字数
        $articlespliter->show_page=5;  //当前显示第几页
        $splitbody=$articlespliter->split($body);
        $totalpage=$articlespliter->getTotalPage();
        echo $splitbody;
        echo "<br />{$totalpage}";
}
  

```

